# 4-3. MCP 상시 서버 + 임베딩 기반 RAG 안정화

## 작업 목적
요청마다 MCP 서버가 재기동되는 병목과 RAG 검색 품질 편차를 줄이기 위해, MCP 연결 방식을 상시 서버(HTTP) 기반으로 전환하고 임베딩 기반 검색을 도입했다.

## 구현 범위
- MCP 연결/운영 방식 개선
  - 기본 transport를 `streamable_http`로 변경
  - `RAG_MCP_HOST`, `RAG_MCP_PORT`, `RAG_MCP_PATH`, `RAG_MCP_AUTOSTART` 환경 변수 추가
  - MCP timeout 기본값을 10초로 상향
- RAG 임베딩 모델 교체 및 Chroma 연동 강화
  - `sentence-transformers` 의존성 추가
  - 기본 임베딩 모델: `intfloat/multilingual-e5-small`
  - e5 query/passage prefix 전처리 적용
  - 컬렉션을 `upsert`로 동기화하여 재시작 시 일관성 유지
- 운영 문서/예시 환경값 업데이트
  - README, handoff, `.env.example`에 실행/설정 기준 반영

## 변경 파일
- `src/mcp/rag_server.py`
- `src/api/config.py`
- `requirements.txt`
- `.env.example`
- `README.md`
- `PROJECT_HANDOFF.md`

## 확인 포인트
- 서버 재기동 없이 다중 이벤트 요청 시 MCP retrieval이 반복적으로 성공하는지 확인
- `rag_source`가 `mcp`로 유지되는 비율 개선 여부 확인
- Gemini 쿼터 초과 시에도 fallback 경로로 API 응답은 안정적으로 유지되는지 확인
