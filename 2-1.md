# 2-1. Jetson VLM 파이프라인 1차 구현 요약

## 목표
- Jetson에서 웹캠 프레임을 주기적으로 분석하고,
- 위험 상황이면 로컬 알람 + 서버 이벤트 전송을 수행하는 MVP를 구현.

## 구현 파일
- `src/edge/main.py`
- `src/edge/config.py`
- `src/edge/vlm_client.py`
- `src/edge/alerts.py`
- `src/edge/server_client.py`

## 핵심 구현 방식
1. 카메라 루프
- `cv2.VideoCapture`로 카메라 오픈 후 무한 루프 처리.
- `capture_interval_sec`(기본 10초)마다 프레임 분석.

2. 위험 판단
- `VLMClient.analyze_frame()` 호출.
- 초기 버전은 Gemma 실연결 전 단계라, 색상 비율 heuristic 기반 더미 판단 사용.

3. 위험 이벤트 처리
- 위험일 때 payload 생성:
  - `event_id`, `timestamp`, `source`, `summary`, `confidence`, `model`
- `DangerEventClient`로 FastAPI 서버에 POST 전송.

4. 로컬 알람
- `AlertController.trigger_danger()`로 LED/사이렌 경고.
- 실장비 연결 전에는 simulate 모드 로그로 동작.

5. 안정성 요소
- cooldown(`danger_cooldown_sec`) 적용으로 중복 경고 완화.
- 종료 시 cleanup 수행(LED off, camera release).

## 설정 포인트
- 환경변수 기반 설정 (`EDGE_*`):
  - 카메라 인덱스, 샘플링 간격, 서버 URL, 타임아웃, 재시도, GPIO 핀 등.

## 한계(1차 구현 시점)
- VLM 실제 Gemma3 4B 호출은 미구현(placeholder).
- 오디오/부저 실제 하드웨어 제어는 TODO.

